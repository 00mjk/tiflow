groups:
- name: alert.rules
  rules:
  - alert: DM_remain_storage_of_relay_log
    expr: dm_relay_space{instance="$instance", type="available"} < 10*1024*1024*1024
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: dm_relay_space{instance="$instance", type="available"} < 10*1024*1024*1024
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM remain storage of relay log

  - alert: DM_relay_process_exits_with_error
    expr: changes(dm_relay_exit_with_error_count{instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_relay_exit_with_error_count{instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM relay process exits with error

  - alert: DM_relay_log_data_corruption
    expr: changes(dm_relay_data_corruption{instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: emergency
      expr: changes(dm_relay_data_corruption{instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM relay log data corruption

  - alert: DM_fail_to_read_binlog_from_master
    expr: changes(dm_relay_read_error_count{instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_relay_read_error_count{instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM fail to read binlog from master

  - alert: DM_fail_to_write_relay_log
    expr: changes(dm_relay_write_error_count{instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_relay_write_error_count{instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM fail to write relay log

  - alert: DM_dump_process_exists_with_error
    expr: changes(dm_mydumper_exit_with_error_count{task="$task",instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_mydumper_exit_with_error_count{task="$task",instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, task: {{ $labels.task }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM dump process exists with error

  - alert: DM_load_process_exists_with_error
    expr: changes(dm_loader_exit_with_error_count{task="$task",instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_loader_exit_with_error_count{task="$task",instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, task: {{ $labels.task }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM load process exists with error

  - alert: DM_sync_process_exists_with_error
    expr: changes(dm_syncer_exit_with_error_count{task="$task", instance="$instance"}[1m]) > 0
    labels:
      env: ENV_LABELS_ENV
      level: critical
      expr: changes(dm_syncer_exit_with_error_count{task="$task", instance="$instance"}[1m]) > 0
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, task: {{ $labels.task }}, values: {{ $value }}'
      value: '{{ $value }}'
      summary: DM sync process exists with error
